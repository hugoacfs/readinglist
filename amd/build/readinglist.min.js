// This file is part of Readinglist Plugin
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 * Readinglist plugin version info
 *
 * @package    mod_readinglist
 * @author     Hugo Soares <h.soares@chi.ac.uk> {@link www.github.com/hugoacfs}
 * @copyright  2020 University of Chichester {@link www.chi.ac.uk}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */

define(['jquery', 'core/ajax'], function ($, ajax) {

  return {
    init: function () {

      $("#id_isbn_btn").click(function () {
        var isbn = $("#id_isbn").val();
        var url = 'https://openlibrary.org/isbn/' + isbn + '.json';
        $.get(url, 'json', function (data) {
          $("#id_title").val(data.title + ' - ' + data.subtitle);
          $("#id_isbn").val(data.isbn_13);
          $("#id_year").val(data.publish_date);
          $("#id_url").val('https://openlibrary.org' + data.key);
        })
        .fail(function() {
          $("#id_title").val('Could not find book.');
          $("#id_year").val('');
          $("#id_url").val('');
        });
      });

      $("#id_url_btn").click(function () {
        var url = $("#id_url").val();
        console.log(url);
        $.post( "http://localhost/~hsoares/moodle_stuff/moodle/mod/readinglist/fetch_html.php", {url: url})
        .done(function( data ){
          json_data = JSON.parse(data);
          console.log(json_data);
          $("#id_title").val(json_data.title);
          $("#id_year").val(json_data.year);
          $("#id_name").val(json_data.name);
        })
        .fail(function() {
          console.log('Issues getting the site...');
        });
      });
    }
  };
});